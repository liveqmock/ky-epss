<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/ui.xhtml">
<ui:define name="head">
    <link type="text/css" href="#{request.contextPath}/UI/epss/epss.css" rel="stylesheet"/>
    <script type="text/javascript" src="#{request.contextPath}/UI/support/pub.js"/>
    <script type="text/javascript" language="javascript">
        document.onkeydown = function TabReplace() {
            if (event.keyCode == 13) {
                if (event.srcElement.tagName != 'BUTTON')
                    event.keyCode = 9;
                else
                    event.srcElement.click();
            }
        }
        function actSelect(obj) {
            var pkid = obj;
            var sfeature = "dialogwidth:1100px;dialogheight:600px;center:yes;location:no;help:no;resizable:no;scroll:yes;status:no";
            var arg = new Object();
            arg.doType = "select";
            var rtn = dialog("../item/itemMng_Tkctt.xhtml?strFlowType=Mng&amp;strTkCttPkid=" + pkid + "", arg, sfeature);
            document.getElementById("form:qryBtn").click();
        }
    </script>
</ui:define>
<ui:define name="content">
<h:form id="form" enctype="multipart/form-data">
<p:growl id="msgs" showDetail="true"/>
<p:focus for="id"/>
<p:panel>
    <h:panelGrid id="pdQry" columns="2" style="width: 100%">
        <h:panelGrid columns="4">
            <p:outputLabel value="合同编号：" for="id"/>
            <p:inputText id="id" value="#{tkCttInfoAction.cttInfoShowQry.id}"
                         style="width: 200px"/>
            <p:outputLabel value="合同名称：" for="cttName"/>
            <p:inputText id="cttName" value="#{tkCttInfoAction.cttInfoShowQry.name}"
                         style="width: 360px"/>
        </h:panelGrid>
        <h:panelGrid columns="3">
            <p:commandButton id="qryBtn" value="查询"
                             action="#{tkCttInfoAction.onQueryAction('Mng','true')}"
                             update="pdt,msgs">
            </p:commandButton>
            <p:commandButton id="resetBtn" value="重置"
                             type="reset"
                             update="pdQry,msgs">
            </p:commandButton>
            <p:ajaxStatus style="width:16px;height:16px;">
                <f:facet name="start">
                    <h:graphicImage value="/images/ajaxloading.gif"/>
                </f:facet>
                <f:facet name="complete">
                    <h:outputText value=""/>
                </f:facet>
            </p:ajaxStatus>
        </h:panelGrid>
    </h:panelGrid>
</p:panel>
<p:commandButton id="addBtn"
                 value="增加" icon="ui-icon-plus"
                 action="#{tkCttInfoAction.resetActionForAdd()}"
                 update="pgViewForAdd"
                 onclick="PF('wVDlgViewForAdd').show()">
</p:commandButton>
<p:dataTable id="pdt" style="width:100%;"
             value="#{tkCttInfoAction.cttInfoShowList}"
             var="record"
             rowKey="#{record.pkid}"
             selectionMode="single"
             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks}
                             {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
             paginator="true"
             paginatorPosition="bottom"
             rows="20"
             rowIndexVar="row"
             rowsPerPageTemplate="200,100,50,30,20,10"
             emptyMessage="数据记录为空..."
             widgetVar="DtInitTkcttList"
             rowStyleClass="#{record.statusFlag eq null? null:'rowDoneStyle'}"
             scrollable="true">
    <p:column headerText="操作" style="width:62px">
        <p:commandButton icon="ui-icon-pencil"
                         action="#{tkCttInfoAction.selectRecordAction('Mng','Upd',record)}"
                         update="pdt,:form:pgViewForUpd,:form:msgs"
                         onclick="PF('wVDlgViewForUpd').show()">
        </p:commandButton>
        <p:commandButton icon="ui-icon-trash"
                         action="#{tkCttInfoAction.selectRecordAction('Mng','Del',record)}"
                         update="pdt,:form:pgViewForDel,:form:msgs"
                         onclick="PF('wVDlgViewForDel').show()">
        </p:commandButton>
        <p:commandButton icon="ui-icon-document"
                         action="#{tkCttInfoAction.attachmentStrToList()}"
                         update="pdt,:form:pgAttachmentView,:form:msgs"
                         onclick="PF('wvAttachmentList').show()">
            <f:setPropertyActionListener value="#{record}" target="#{tkCttInfoAction.cttInfoShowAttachment}"/>
        </p:commandButton>
        <p:commandButton icon="ui-icon-triangle-1-e"
                         onclick="actSelect('#{record.pkid}')">
        </p:commandButton>
    </p:column>
    <p:column headerText="序号" style="width:30px">
        <h:outputText value="#{row + 1}"/>
    </p:column>
    <p:column headerText="总包合同号" style="width:120px;text-align:center">
        <h:outputText value="#{record.id}"/>
    </p:column>
    <p:column headerText="总包合同名" style="width:200px;text-align:left">
        <h:outputText value="#{record.name}"/>
    </p:column>
    <p:column headerText="签订甲方" style="width:180px;text-align:left">
        <h:outputText value="#{esCommon.getCustNameByCustIdFromList(record.signPartA)}"/>
    </p:column>
    <p:column headerText="签订乙方" style="width:180px;text-align:left">
        <h:outputText value="#{esCommon.getCustNameByCustIdFromList(record.signPartB)}"/>
    </p:column>
    <p:column headerText="状态标志" style="width:60px;text-align:center">
        <h:outputText value="#{esFlowControl.getLabelByValueInStatusFlaglist(record.statusFlag)}"/>
    </p:column>
    <p:column headerText="原因" style="width:60px;text-align:center">
        <h:outputText value="#{esFlowControl.getLabelByValueInPreStatusFlaglist(record.preStatusFlag)}"/>
    </p:column>
    <p:column headerText="开始时间" style="width:66px;text-align:center">
        <h:outputText value="#{record.cttStartDate}"/>
    </p:column>
    <p:column headerText="截止时间" style="width:66px;text-align:center">
        <h:outputText value="#{record.cttEndDate}"/>
    </p:column>
    <p:column headerText="签订日期" style="width:66px;text-align:center">
        <h:outputText value="#{record.signDate}"/>
    </p:column>
    <p:column headerText="备注内容" style="width:200px;text-align:left">
        <h:outputText value="#{record.note}"/>
    </p:column>
</p:dataTable>

<!--附件列表维护-->
<p:dialog id="dLAttachmentList" widgetVar="wvAttachmentList" modal="true"
          showEffect="clip" hideEffect="fold" header="附件列表">
    <p:growl id="messages" showDetail="true"/>
    <h:panelGrid id="pgAttachmentView">
        <p:fileUpload id="attachmentName" fileUploadListener="#{tkCttInfoAction.upload}"
                      mode="advanced"
                      sizeLimit="1000000"
                      multiple="true"
                      label="选择" showButtons="true"
                      cancelLabel="全部取消" uploadLabel="全部上传" process="@this"
                      allowTypes="/(\.|\/)(gif|jpe?g|png|xls|xlsx|doc|docx)$/"
                      update="pdtAttachmentList,attachmentName">
        </p:fileUpload>
        <p:dataTable id="pdtAttachmentList" style="width:100%;"
                     value="#{tkCttInfoAction.attachmentList}"
                     var="recordAttachment"
                     rowKey="#{recordAttachment.COLUMN_NAME}"
                     selectionMode="single"
                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks}
                                 {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     paginator="true"
                     paginatorPosition="bottom"
                     rows="5"
                     rowsPerPageTemplate="100,50,30,15,5"
                     emptyMessage="数据记录为空..."
                     widgetVar="WvPdtAttachmentList">
            <p:column headerText="附件ID" style="text-align:left">
                <h:outputText value="#{recordAttachment.COLUMN_ID}"/>
            </p:column>
            <p:column headerText="附件名" style="text-align:left">
                <h:outputText value="#{recordAttachment.COLUMN_NAME}"/>
            </p:column>
            <p:column headerText="缩略图" style="text-align:center" rendered="false">
                <h:graphicImage value="/upload/#{recordAttachment.COLUMN_NAME}" styleClass="img"/>
            </p:column>
            <p:column headerText="预览">
                <p:commandButton id="selectButton" update=":form:imageShow"
                                 action="#{tkCttInfoAction.onViewAttachment(recordAttachment)}"
                                 oncomplete="dlgWvView.show()"
                                 icon="ui-icon-search" title="View">
                </p:commandButton>
            </p:column>
            <p:column headerText="操作" style="width:62px">
                <p:commandButton icon="ui-icon-arrowrefresh-1-w"
                                 ajax="false"
                                 actionListener="#{tkCttInfoAction.download(recordAttachment.COLUMN_PATH)}">
                    <p:fileDownload value="#{tkCttInfoAction.downloadFile}"/>
                </p:commandButton>
                <p:commandButton icon="ui-icon-trash"
                                 action="#{tkCttInfoAction.delAttachmentRecordAction(recordAttachment)}"
                                 update=":form:pgAttachmentView,:form:msgs">
                </p:commandButton>
            </p:column>
        </p:dataTable>
        <p:dialog id="imageShow" widgetVar="dlgWvView" height="400px" modal="false">
            <h:graphicImage binding="#{tkCttInfoAction.image}"/>
        </p:dialog>
    </h:panelGrid>
</p:dialog>

<p:dialog id="dlgViewForAdd" header="总包合同增加信息" widgetVar="wVDlgViewForAdd"
          esizable="false" modal="true"
          showEffect="clip" hideEffect="fold">
    <h:panelGrid id="pgViewForAdd">
        <h:panelGrid columns="3">
            <p:outputLabel value="合同编号：" for="idForAdd"/>
            <p:inputText id="idForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.id}"/>
            <p:commandButton id="autoSetIdBtnForAdd" icon="ui-icon-plus"
                             action="#{tkCttInfoAction.setMaxNoPlusOne()}"
                             update="idForAdd"
                             style="height:20px">
            </p:commandButton>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="合同名称：" for="cttNameForAdd"/>
            <p:inputText id="cttNameForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.name}"
                         style="width:328px"/>
        </h:panelGrid>
        <h:panelGrid columns="4">
            <p:outputLabel value="备注内容：" for="noteForAdd"/>
            <p:inputText id="noteForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.note}"/>
            <p:outputLabel value="签订日期：" for="signDateForAdd"/>
            <p:inputText id="signDateForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.signDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
            <p:outputLabel value="开始时间：" for="cttStartDateForAdd"/>
            <p:inputText id="cttStartDateForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.cttStartDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
            <p:outputLabel value="截止时间：" for="cttEndDateForAdd"/>
            <p:inputText id="cttEndDateForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.cttEndDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="签订甲方：" for="signPartAForAdd"/>
            <p:selectOneMenu id="signPartAForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.signPartA}"
                             style="width:328px">
                <f:selectItems value="#{esCommon.customerlist}"/>
            </p:selectOneMenu>
            <p:outputLabel value="签订乙方：" for="signPartBForAdd"/>
            <p:selectOneMenu id="signPartBForAdd" value="#{tkCttInfoAction.cttInfoShowAdd.signPartB}"
                             style="width:328px">
                <f:selectItems value="#{esCommon.customerlist}"/>
            </p:selectOneMenu>
        </h:panelGrid>
        <h:panelGrid id="pgOperBtnForAdd" columns="2">
            <p:commandButton id="submitBtnForAdd"
                             value="提交（增加）"
                             action="#{tkCttInfoAction.onClickForMngAction()}"
                             update="pdt,msgs,pgViewForAdd">
            </p:commandButton>
            <p:commandButton id="resetBtnForAdd" value="重置"
                             type="reset"
                             update="pgViewForAdd">
            </p:commandButton>
        </h:panelGrid>
    </h:panelGrid>
</p:dialog>
<p:dialog id="dlgViewForUpd" header="总包合同更新信息" widgetVar="wVDlgViewForUpd"
          resizable="false" modal="true"
          showEffect="clip" hideEffect="fold">
    <h:panelGrid id="pgViewForUpd">
        <h:panelGrid columns="3">
            <p:outputLabel value="合同编号：" for="idForUpd"/>
            <p:inputText id="idForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.id}"/>
            <p:commandButton id="autoSetIdBtnForUpd" icon="ui-icon-plus"
                             action="#{tkCttInfoAction.setMaxNoPlusOne()}"
                             update="idForUpd"
                             style="height:20px">
            </p:commandButton>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="合同名称：" for="cttNameForUpd"/>
            <p:inputText id="cttNameForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.name}"
                         style="width:328px"/>
        </h:panelGrid>
        <h:panelGrid columns="4">
            <p:outputLabel value="备注内容：" for="noteForUpd"/>
            <p:inputText id="noteForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.note}"/>
            <p:outputLabel value="签订日期：" for="signDateForUpd"/>
            <p:inputText id="signDateForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.signDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
            <p:outputLabel value="开始时间：" for="cttStartDateForUpd"/>
            <p:inputText id="cttStartDateForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.cttStartDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
            <p:outputLabel value="截止时间：" for="cttEndDateForUpd"/>
            <p:inputText id="cttEndDateForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.cttEndDate}"
                         onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="签订甲方：" for="signPartAForUpd"/>
            <p:selectOneMenu id="signPartAForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.signPartA}">
                <f:selectItems value="#{esCommon.customerlist}"/>
            </p:selectOneMenu>
            <p:outputLabel value="签订乙方：" for="signPartBForUpd"/>
            <p:selectOneMenu id="signPartBForUpd" value="#{tkCttInfoAction.cttInfoShowUpd.signPartB}"
                             style="width:328px">
                <f:selectItems value="#{esCommon.customerlist}"/>
            </p:selectOneMenu>
        </h:panelGrid>
        <h:panelGrid columns="4">
            <p:outputLabel for="createdByNameUpd" value="创建人："/>
            <h:inputText id="createdByNameUpd"
                         value="#{tkCttInfoAction.cttInfoShowUpd.createdByName}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="createdDateUpd" value="创建时间："/>
            <h:inputText id="createdDateUpd"
                         value="#{tkCttInfoAction.cttInfoShowUpd.createdDate}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="lastUpdByNameUpd" value="修改人："/>
            <h:inputText id="lastUpdByNameUpd"
                         value="#{tkCttInfoAction.cttInfoShowUpd.lastUpdByName}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="lastUpdDateUpd" value="修改时间："/>
            <h:inputText id="lastUpdDateUpd"
                         value="#{tkCttInfoAction.cttInfoShowUpd.lastUpdDate}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="modificationNumUpd" value="修改次数："/>
            <h:inputText id="modificationNumUpd"
                         value="#{tkCttInfoAction.cttInfoShowUpd.modificationNum}"
                         style="background-color:gainsboro;text-align:right;" readonly="true">
                <f:convertNumber type="number" pattern="#,###,###,###,##0"/>
            </h:inputText>
        </h:panelGrid>
        <h:panelGrid id="pgOperBtnForUpd" columns="2">
            <p:commandButton id="submitBtnForUpd"
                             value="提交（更新）"
                             action="#{tkCttInfoAction.onClickForMngAction()}"
                             update="pdt,msgs,pgViewForUpd">
            </p:commandButton>
            <p:commandButton id="resetBtnForUpd" value="重置"
                             type="reset"
                             update="pgViewForUpd">
            </p:commandButton>
        </h:panelGrid>
    </h:panelGrid>
</p:dialog>
<p:dialog id="dlgViewForDel" header="总包合同删除信息" widgetVar="wVDlgViewForDel"
          resizable="false" modal="true"
          showEffect="clip" hideEffect="fold">
    <h:panelGrid id="pgViewForDel">
        <h:panelGrid columns="3">
            <p:outputLabel value="合同编号：" for="idForDel"/>
            <p:inputText id="idForDel" value="#{tkCttInfoAction.cttInfoShowDel.id}"
                         readonly="true"
                         style="background-color:gainsboro;"/>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="合同名称：" for="cttNameForDel"/>
            <p:inputText id="cttNameForDel" value="#{tkCttInfoAction.cttInfoShowDel.name}"
                         readonly="true"
                         style="background-color:gainsboro;width:328px"/>
        </h:panelGrid>
        <h:panelGrid columns="4">
            <p:outputLabel value="备注内容：" for="noteForDel"/>
            <p:inputText id="noteForDel" value="#{tkCttInfoAction.cttInfoShowDel.note}"
                         readonly="true"
                         style="background-color:gainsboro;"/>
            <p:outputLabel value="签订日期：" for="signDateForDel"/>
            <p:inputText id="signDateForDel" value="#{tkCttInfoAction.cttInfoShowDel.signDate}"
                         readonly="true"
                         style="background-color:gainsboro;"/>
            <p:outputLabel value="开始时间：" for="cttStartDateForDel"/>
            <p:inputText id="cttStartDateForDel" value="#{tkCttInfoAction.cttInfoShowDel.cttStartDate}"
                         readonly="true"
                         style="background-color:gainsboro;"/>
            <p:outputLabel value="截止时间：" for="cttEndDateForDel"/>
            <p:inputText id="cttEndDateForDel" value="#{tkCttInfoAction.cttInfoShowDel.cttEndDate}"
                         readonly="true"
                         style="background-color:gainsboro;"/>
        </h:panelGrid>
        <h:panelGrid columns="2">
            <p:outputLabel value="签订甲方：" for="signPartAForDel"/>
            <p:inputText id="signPartAForDel" value="#{tkCttInfoAction.cttInfoShowDel.signPartAName}"
                         readonly="true"
                         style="background-color:gainsboro;;width:328px"/>
            <p:outputLabel value="签订乙方：" for="signPartBForDel"/>
            <p:inputText id="signPartBForDel" value="#{tkCttInfoAction.cttInfoShowDel.signPartBName}"
                         readonly="true"
                         style="background-color:gainsboro;;width:328px"/>
        </h:panelGrid>
        <h:panelGrid columns="4">
            <p:outputLabel for="createdByNameDel" value="创建人："/>
            <h:inputText id="createdByNameDel"
                         value="#{tkCttInfoAction.cttInfoShowDel.createdByName}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="createdDateDel" value="创建时间："/>
            <h:inputText id="createdDateDel"
                         value="#{tkCttInfoAction.cttInfoShowDel.createdDate}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="lastUpdByNameDel" value="修改人："/>
            <h:inputText id="lastUpdByNameDel"
                         value="#{tkCttInfoAction.cttInfoShowDel.lastUpdByName}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="lastUpdDateDel" value="修改时间："/>
            <h:inputText id="lastUpdDateDel"
                         value="#{tkCttInfoAction.cttInfoShowDel.lastUpdDate}"
                         style="background-color:gainsboro" readonly="true"/>
            <p:outputLabel for="modificationNumDel" value="修改次数："/>
            <h:inputText id="modificationNumDel"
                         value="#{tkCttInfoAction.cttInfoShowDel.modificationNum}"
                         style="background-color:gainsboro;text-align:right;" readonly="true">
                <f:convertNumber type="number" pattern="#,###,###,###,##0"/>
            </h:inputText>
        </h:panelGrid>
        <h:panelGrid id="pgOperBtnForDel">
            <p:commandButton id="submitBtnForDel"
                             value="提交（删除）"
                             action="#{tkCttInfoAction.onClickForMngAction()}"
                             update="pdt,msgs,pgViewForDel">
            </p:commandButton>
        </h:panelGrid>
    </h:panelGrid>
</p:dialog>
</h:form>
</ui:define>
</ui:composition>